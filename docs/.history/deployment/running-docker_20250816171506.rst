Running GUANACO with Docker
============================

Run Locally
-----------

To run and install GUANACO using docker, only changes need to be made in the Json file and the AnnData or MuuData needs to be present in any given folder. There is no need to pull the code from git repository, it will be sufficient to just download the example Json file and create user's own data. However, if the user has already downloaded the git repository, that is fine as well. The user just needs to use the appropriate folder path. There is no need to install python for docker, if there is an existing python in the machine, it is alright but not something necessary. Users can simply follow the mentioned steps using their terminal:

|

Step 1. Install Docker
^^^^^^^^^^^^^^^^^^^^^^^

(Ignore this part if docker is already installed in the machine)

Install Docker in the local machine following the link: https://www.docker.com/products/docker-desktop/,

(For Linux the user can also use the following command: ``sudo apt install -y docker.io``)

Once docker is installed and running, the user can check the docker version by using this command: ``docker --version``

|

Step 2. Run Docker Image
^^^^^^^^^^^^^^^^^^^^^^^^^

Note: we have already built the docker image for GUANACO, user only needs to mount their data and Json file with the docker image, and it will be running fine, please follow the command precisely below.

.. code-block:: bash

   docker run -p 8080:8080 \
   -v {directory of your data}:/app/data \
   -v {your json file}.json:/app/config.json \
   systemimmunometabolism/guanaco

We have provided an example below of how it can be done in the user local machine, however, please do not strictly follow the example, it is just for understanding:

*docker run -p 8080:8080 \
-v ~/Downloads:/app/data \
-v ~/Downloads/guanaco.json:/app/config.json \
systemimmunometabolism/guanaco*

Here, the user does not have to name the data file only mapping it will be enough

The application will be running in http://0.0.0.0:8080/

Deploy in Server
----------------

To run and install GUANACO using docker, only changes need to be made in the Json file and the AnnData or MuuData needs to be present in any given folder. There is no need to pull the code from git repository, it will be sufficient to just download the example Json file and create user's own data. However, if the user has already downloaded the git repository, that is fine as well. The user just needs to use the appropriate folder path. There is no need to install python for docker, if there is an existing python in the machine, it is alright but not something necessary. Users can simply follow the mentioned steps using their terminal.

Please note that the user must connect to their server for deployment. Connection can be made to the server using the following command (this depends completely on the server)

``ssh -i ~/filepath/my-aws-key.pem instance-name@<EC2_PUBLIC_IP>``

**Note:** The instance name is mostly the name of the OS image used for the server like ubuntu or ec2-user for linux, in this case ubuntu is much preferable as it comes with updated version of python, however this again depends on the server operator

Step 1. Install Docker
^^^^^^^^^^^^^^^^^^^^^^^

(Ignore this part if docker is already installed in the machine)

Users can Install Docker in the virtual machine using this command:

.. code-block:: bash

   sudo apt update
   sudo apt install -y docker.io

Or the user can follow the instruction given by docker for setup in https://docs.docker.com/engine/install/ubuntu/

Once docker is installed run the following commands to start docker:

.. code-block:: bash

   sudo systemctl enable docker
   sudo systemctl start docker

Add docker to user group using this command (this is not necessary but is just for convenience)

.. code-block:: bash

   sudo usermod -aG docker $USER

Test docker setup by

.. code-block:: bash

   docker run hello-world

Or, if docker is not added to user group

.. code-block:: bash

   sudo docker run hello-world

Step 2. Run Docker Image
^^^^^^^^^^^^^^^^^^^^^^^^^

**Note:** We have already built the docker image for GUANACO, user only needs to mount their data and Json file with the docker image, and it will be running fine, please follow the command precisely below.

To mount the Json file and data in the server, upload the files to the server using the command:
``scp -i /path/to/your-key.pem /path/to/your/file/guanaco.json ubuntu@EC2_PUBLIC_IP:/home/ubuntu/``

Once the files are uploaded, run the following command:

.. code-block:: bash

   docker run -p 8080:8080 \
   -v {directory of your data}:/app/data \
   -v {your json file}.json:/app/config.json \
   systemimmunometabolism/guanaco

Or, if docker is not added to user group

.. code-block:: bash

   sudo docker run -p 8080:8080 \
   -v {directory of your data}:/app/data \
   -v {your json file}.json:/app/config.json \
   systemimmunometabolism/guanaco

The application will be running in 'http://<instance-public-ip>:8080/'' (or the url the IP is mapped to)

